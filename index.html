<!doctype html>
<html>

<head>
  <title>Hello, Snaps!</title>
  <link rel="icon" type="image/svg" href="./images/icon.svg" />
</head>

<body>
  <h1>Hello, Snaps!</h1>
  <details>
    <summary>Instructions</summary>
    <ul>
      <li>First, click "Connect". Then, try out the other buttons!</li>
      <li>Please note that:</li>
      <ul>
        <li>
          The <code>snap.manifest.json</code> and <code>package.json</code> must be located in the server root
          directory..
        </li>
        <li>
          The Snap bundle must be hosted at the location specified by the <code>location</code> field of
          <code>snap.manifest.json</code>.
        </li>
      </ul>
    </ul>
  </details>
  <br />

  <button class="connect">Connect</button>
  <button class="sendHello">Send Hello</button>
</body>

<script>
  const snapId = `local:${window.location.href}`;
  // const snapId = `http://localhost:8080`;

  const connectButton = document.querySelector('button.connect')
  const sendButton = document.querySelector('button.sendHello')

  connectButton.addEventListener('click', connect)
  sendButton.addEventListener('click', send)

  // here we get permissions to interact with and install the snap
  async function connect() {
    await ethereum.request({
      method: 'wallet_enable',
      params: [{
        wallet_snap: { [snapId]: {} },
      }]
    })
  }

  const { ethereum } = window
  console.log('ethereum ', ethereum)

  console.log('snap id ', snapId)

  // here we call the snap's "hello" method
  async function send() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'hello', token0: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2", token1: "0xF9A2D7E60a3297E513317AD1d7Ce101CC4C6C8F6"
        }]
      })
      console.log('response: ', response)
      alert(response.result)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function checkTokenCompliance() {
    try{
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'checkcompliance' , address: "0x08BA8CBbefa64Aaf9DF25e57fE3f15eCC277Af74"
        }]
      })

      console.log('result from compliance ', response)
    }catch(err){
      console.log(err);
      alert('Problem happened: ' + err.message || err);
    }
  }
</script>

</html>